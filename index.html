
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI è¯å…¸åŠ©æ‰‹</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; padding: 15px; background-color: #f9f9f9; color: #333; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .header { font-size: 1.1em; font-weight: bold; color: #7d5fff; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .badge { font-size: 0.7em; background: #eee; padding: 2px 6px; border-radius: 4px; color: #666; font-weight: normal; }
        .content { line-height: 1.6; font-size: 0.95em; white-space: pre-wrap; }
        .input-group { margin-top: 20px; border-top: 1px solid #eee; padding-top: 10px; }
        input { padding: 8px; border: 1px solid #ccc; border-radius: 4px; width: 65%; }
        button { padding: 8px 12px; background: #7d5fff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        .hidden { display: none; }
        .error { color: #d63031; font-size: 0.9em; margin-top: 10px; background: #fff0f0; padding: 10px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="card">
    <div class="header">
        <span>ğŸ¤– Kimi æ·±åº¦é‡Šä¹‰</span>
        <span class="badge">SiliconFlow</span>
    </div>
    
    <div id="result" class="content">æ­£åœ¨å‡†å¤‡è¿æ¥...</div>
    
    <div id="setup-area" class="input-group hidden">
        <p style="font-size:0.8em; color:#666;">è¯·è¾“å…¥ SiliconFlow å¯†é’¥ (sk-å¼€å¤´)<br>å¯†é’¥ä»…ä¿å­˜åœ¨æœ¬åœ°ï¼Œä¸ä¼šä¸Šä¼  GitHub</p>
        <input type="password" id="apiKeyInput" placeholder="sk-gigbzfj...">
        <button onclick="saveKey()">ä¿å­˜å¹¶è¿æ¥</button>
    </div>
    
    <div style="margin-top:10px; font-size:0.8em; text-align:right;">
        <a href="#" onclick="clearKey()" style="color:#999; text-decoration:none;">é‡ç½®å¯†é’¥</a>
    </div>
</div>

<script>
    // --- æ ¸å¿ƒé…ç½®åŒºåŸŸ (å·²ä¿®æ”¹ä¸ºä½ æä¾›çš„å‚æ•°) ---
    const CONFIG = {
        apiUrl: 'https://api.siliconflow.cn/v1/chat/completions',
        model: 'moonshotai/Kimi-K2-Thinking'
    };
    // ----------------------------------------

    const resultDiv = document.getElementById('result');
    const setupArea = document.getElementById('setup-area');

    // 1. è·å– URL å‚æ•°ä¸­çš„å•è¯
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
            var pair = vars[i].split("=");
            if(pair[0] == variable){return decodeURIComponent(pair[1]);}
        }
        return null;
    }

    // 2. ä¿å­˜ Key åˆ°æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ (LocalStorage)
    function saveKey() {
        const input = document.getElementById('apiKeyInput').value.trim();
        if(input.startsWith('sk-')) {
            localStorage.setItem('sf_key', input);
            setupArea.classList.add('hidden');
            location.reload(); 
        } else {
            alert('å¯†é’¥æ ¼å¼ä¸å¯¹ï¼Œå¿…é¡»ä»¥ sk- å¼€å¤´');
        }
    }

    function clearKey() {
        if(confirm('è¦æ¸…é™¤å¯†é’¥å—ï¼Ÿ')) {
            localStorage.removeItem('sf_key');
            location.reload();
        }
    }

    async function main() {
        const apiKey = localStorage.getItem('sf_key');
        const word = getQueryVariable("q");

        // æ£€æŸ¥ Key
        if (!apiKey) {
            resultDiv.innerHTML = "è¯·åœ¨ä¸‹æ–¹è¾“å…¥æ‚¨çš„ API Keyã€‚";
            setupArea.classList.remove('hidden');
            return;
        }

        // æ£€æŸ¥å•è¯
        if (!word) {
            resultDiv.innerHTML = "ç­‰å¾…æŸ¥è¯¢... <br><span style='font-size:0.8em;color:#888'>è¯·åœ¨æ¬§è·¯è¯å…¸ä¸­æµ‹è¯•ï¼Œæˆ–åœ¨ç½‘å€ååŠ ä¸Š ?q=å•è¯</span>";
            return;
        }

        resultDiv.innerHTML = "ğŸ¤” Kimi æ­£åœ¨æ€è€ƒ <b>" + word + "</b> çš„å«ä¹‰...";

        // å‘é€è¯·æ±‚
        try {
            const response = await fetch(CONFIG.apiUrl, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: CONFIG.model,
                    messages: [
                        {
                            role: "system", 
                            content: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„è‹±è¯­è¯å…¸åŠ©æ‰‹ã€‚è¯·è§£é‡Šç”¨æˆ·çš„å•è¯ã€‚ç»“æ„è¦æ±‚ï¼š\n1. ã€æ ¸å¿ƒé‡Šä¹‰ã€‘ï¼šä¸­æ–‡å«ä¹‰ã€‚\n2. ã€è¯æºåˆ†æã€‘ï¼š(å¦‚æœ‰)ç®€å•çš„è¯æ ¹è¯ç¼€ã€‚\n3. ã€åœºæ™¯ä¾‹å¥ã€‘ï¼š1ä¸ªåœ°é“çš„è‹±æ–‡ä¾‹å¥é™„å¸¦ä¸­æ–‡ç¿»è¯‘ã€‚\nè¯·ä½¿ç”¨HTMLçš„<b>æ ‡ç­¾åŠ ç²—å…³é”®ç‚¹ï¼Œä¿æŒæ’ç‰ˆæ•´æ´ã€‚"
                        },
                        {role: "user", content: `è§£é‡Šå•è¯: ${word}`}
                    ],
                    stream: false
                })
            });

            const data = await response.json();

            if (data.error) {
                throw new Error(data.error.message || "API è¿”å›é”™è¯¯");
            }
            
            if (data.choices && data.choices.length > 0) {
                // å¤„ç†æ¢è¡Œï¼Œè®©æ’ç‰ˆæ›´å¥½çœ‹
                let content = data.choices[0].message.content;
                content = content.replace(/\n/g, '<br>');
                content = content.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>'); // å¤„ç† Markdown åŠ ç²—
                resultDiv.innerHTML = content;
            } else {
                resultDiv.innerHTML = "æœªè·å–åˆ°å†…å®¹ï¼Œè¯·æ£€æŸ¥ç½‘ç»œã€‚";
            }

        } catch (error) {
            console.error(error);
            resultDiv.innerHTML = `<div class="error"><b>å‡ºé”™äº†:</b> ${error.message}<br><br>å¯èƒ½åŸå› ï¼š<br>1. å¯†é’¥æ— æ•ˆ<br>2. å…è´¹é¢åº¦å·²ç”¨å®Œ<br>3. è·¨åŸŸé™åˆ¶ (CORS)</div>`;
        }
    }

    main();
</script>
</body>
</html>
